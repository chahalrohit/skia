{"version":3,"names":["PathEffectDeclaration","JsiDeclarationNode","constructor","ctx","type","props","DeclarationType","PathEffect","addChild","child","Error","insertChildBefore","before","compose","pe","children","_children","length","Skia","MakeCompose","reduce","acc","materialize","getOptionalChildInstance","index","getMandatoryChildInstance","isPathEffect","DiscretePathEffectNode","NodeType","DiscretePathEffect","deviation","seed","MakeDiscrete","Path2DPathEffectNode","Path2DPathEffect","matrix","path","processPath","MakePath2D","DashPathEffectNode","DashPathEffect","intervals","phase","MakeDash","CornerPathEffectNode","CornerPathEffect","r","MakeCorner","SumPathEffectNode","SumPathEffect","MakeSum","Line2DPathEffectNode","Line2DPathEffect","width","MakeLine2D","Path1DPathEffectNode","Path1DPathEffect","advance","style","MakePath1D","Path1DEffectStyle","enumKey"],"sources":["PathEffects.ts"],"sourcesContent":["import { Path1DEffectStyle } from \"../../../skia/types\";\nimport type { SkPathEffect } from \"../../../skia/types\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport type {\n  CornerPathEffectProps,\n  DashPathEffectProps,\n  DiscretePathEffectProps,\n  Line2DPathEffectProps,\n  Node,\n  Path1DPathEffectProps,\n  Path2DPathEffectProps,\n} from \"../../types\";\nimport { DeclarationType, NodeType } from \"../../types\";\nimport { enumKey } from \"../datatypes/Enum\";\nimport { processPath } from \"../datatypes\";\n\nabstract class PathEffectDeclaration<\n  P,\n  Nullable extends null | never = never\n> extends JsiDeclarationNode<P, SkPathEffect, Nullable> {\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, DeclarationType.PathEffect, type, props);\n  }\n\n  addChild(child: Node<unknown>) {\n    if (!(child instanceof PathEffectDeclaration)) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    super.addChild(child);\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (!(child instanceof PathEffectDeclaration)) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    super.insertChildBefore(child, before);\n  }\n\n  compose(pe: SkPathEffect) {\n    const children = this._children as PathEffectDeclaration<unknown>[];\n    if (this._children.length === 0) {\n      return pe;\n    } else {\n      return this.Skia.PathEffect.MakeCompose(\n        pe,\n        children.reduce<SkPathEffect | null>((acc, child) => {\n          if (acc === null) {\n            return child.materialize();\n          }\n          return this.Skia.PathEffect.MakeCompose(acc, child.materialize());\n        }, null) as SkPathEffect\n      );\n    }\n  }\n  getOptionalChildInstance(index: number) {\n    const child = this._children[index];\n    if (!child) {\n      return null;\n    }\n    return this.getMandatoryChildInstance(index);\n  }\n\n  getMandatoryChildInstance(index: number) {\n    const child = this._children[index];\n    if (child instanceof JsiDeclarationNode) {\n      if (child.isPathEffect()) {\n        return child.materialize();\n      } else {\n        throw new Error(`Found invalid child ${child.type} in ${this.type}`);\n      }\n    } else {\n      throw new Error(`Found invalid child ${child.type} in ${this.type}`);\n    }\n  }\n}\n\nexport class DiscretePathEffectNode extends PathEffectDeclaration<DiscretePathEffectProps> {\n  constructor(ctx: NodeContext, props: DiscretePathEffectProps) {\n    super(ctx, NodeType.DiscretePathEffect, props);\n  }\n\n  materialize() {\n    const { length, deviation, seed } = this.props;\n    const pe = this.Skia.PathEffect.MakeDiscrete(length, deviation, seed);\n    return this.compose(pe);\n  }\n}\n\nexport class Path2DPathEffectNode extends PathEffectDeclaration<\n  Path2DPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: Path2DPathEffectProps) {\n    super(ctx, NodeType.Path2DPathEffect, props);\n  }\n\n  materialize() {\n    const { matrix } = this.props;\n    const path = processPath(this.Skia, this.props.path);\n    const pe = this.Skia.PathEffect.MakePath2D(matrix, path);\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n\nexport class DashPathEffectNode extends PathEffectDeclaration<DashPathEffectProps> {\n  constructor(ctx: NodeContext, props: DashPathEffectProps) {\n    super(ctx, NodeType.DashPathEffect, props);\n  }\n\n  materialize() {\n    const { intervals, phase } = this.props;\n    const pe = this.Skia.PathEffect.MakeDash(intervals, phase);\n    return this.compose(pe);\n  }\n}\n\nexport class CornerPathEffectNode extends PathEffectDeclaration<\n  CornerPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: CornerPathEffectProps) {\n    super(ctx, NodeType.CornerPathEffect, props);\n  }\n\n  materialize() {\n    const { r } = this.props;\n    const pe = this.Skia.PathEffect.MakeCorner(r);\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n\nexport class SumPathEffectNode extends PathEffectDeclaration<null> {\n  constructor(ctx: NodeContext) {\n    super(ctx, NodeType.SumPathEffect, null);\n  }\n\n  materialize() {\n    return this.Skia.PathEffect.MakeSum(\n      this.getMandatoryChildInstance(0),\n      this.getMandatoryChildInstance(1)\n    );\n  }\n}\n\nexport class Line2DPathEffectNode extends PathEffectDeclaration<\n  Line2DPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: Line2DPathEffectProps) {\n    super(ctx, NodeType.Line2DPathEffect, props);\n  }\n\n  materialize() {\n    const { width, matrix } = this.props;\n    const pe = this.Skia.PathEffect.MakeLine2D(width, matrix);\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n\nexport class Path1DPathEffectNode extends PathEffectDeclaration<\n  Path1DPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: Path1DPathEffectProps) {\n    super(ctx, NodeType.Path1DPathEffect, props);\n  }\n\n  materialize() {\n    const { advance, phase, style } = this.props;\n    const path = processPath(this.Skia, this.props.path);\n    const pe = this.Skia.PathEffect.MakePath1D(\n      path,\n      advance,\n      phase,\n      Path1DEffectStyle[enumKey(style)]\n    );\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AAGA;;AAUA;;AACA;;AACA;;AAEA,MAAeA,qBAAf,SAGUC,wBAHV,CAGwD;EACtDC,WAAW,CAACC,GAAD,EAAmBC,IAAnB,EAAmCC,KAAnC,EAA6C;IACtD,MAAMF,GAAN,EAAWG,uBAAA,CAAgBC,UAA3B,EAAuCH,IAAvC,EAA6CC,KAA7C;EACD;;EAEDG,QAAQ,CAACC,KAAD,EAAuB;IAC7B,IAAI,EAAEA,KAAK,YAAYT,qBAAnB,CAAJ,EAA+C;MAC7C,MAAM,IAAIU,KAAJ,CAAW,4BAA2BD,KAAK,CAACL,IAAK,OAAM,KAAKA,IAAK,EAAjE,CAAN;IACD;;IACD,MAAMI,QAAN,CAAeC,KAAf;EACD;;EAEDE,iBAAiB,CAACF,KAAD,EAAuBG,MAAvB,EAAoD;IACnE,IAAI,EAAEH,KAAK,YAAYT,qBAAnB,CAAJ,EAA+C;MAC7C,MAAM,IAAIU,KAAJ,CAAW,4BAA2BD,KAAK,CAACL,IAAK,OAAM,KAAKA,IAAK,EAAjE,CAAN;IACD;;IACD,MAAMO,iBAAN,CAAwBF,KAAxB,EAA+BG,MAA/B;EACD;;EAEDC,OAAO,CAACC,EAAD,EAAmB;IACxB,MAAMC,QAAQ,GAAG,KAAKC,SAAtB;;IACA,IAAI,KAAKA,SAAL,CAAeC,MAAf,KAA0B,CAA9B,EAAiC;MAC/B,OAAOH,EAAP;IACD,CAFD,MAEO;MACL,OAAO,KAAKI,IAAL,CAAUX,UAAV,CAAqBY,WAArB,CACLL,EADK,EAELC,QAAQ,CAACK,MAAT,CAAqC,CAACC,GAAD,EAAMZ,KAAN,KAAgB;QACnD,IAAIY,GAAG,KAAK,IAAZ,EAAkB;UAChB,OAAOZ,KAAK,CAACa,WAAN,EAAP;QACD;;QACD,OAAO,KAAKJ,IAAL,CAAUX,UAAV,CAAqBY,WAArB,CAAiCE,GAAjC,EAAsCZ,KAAK,CAACa,WAAN,EAAtC,CAAP;MACD,CALD,EAKG,IALH,CAFK,CAAP;IASD;EACF;;EACDC,wBAAwB,CAACC,KAAD,EAAgB;IACtC,MAAMf,KAAK,GAAG,KAAKO,SAAL,CAAeQ,KAAf,CAAd;;IACA,IAAI,CAACf,KAAL,EAAY;MACV,OAAO,IAAP;IACD;;IACD,OAAO,KAAKgB,yBAAL,CAA+BD,KAA/B,CAAP;EACD;;EAEDC,yBAAyB,CAACD,KAAD,EAAgB;IACvC,MAAMf,KAAK,GAAG,KAAKO,SAAL,CAAeQ,KAAf,CAAd;;IACA,IAAIf,KAAK,YAAYR,wBAArB,EAAyC;MACvC,IAAIQ,KAAK,CAACiB,YAAN,EAAJ,EAA0B;QACxB,OAAOjB,KAAK,CAACa,WAAN,EAAP;MACD,CAFD,MAEO;QACL,MAAM,IAAIZ,KAAJ,CAAW,uBAAsBD,KAAK,CAACL,IAAK,OAAM,KAAKA,IAAK,EAA5D,CAAN;MACD;IACF,CAND,MAMO;MACL,MAAM,IAAIM,KAAJ,CAAW,uBAAsBD,KAAK,CAACL,IAAK,OAAM,KAAKA,IAAK,EAA5D,CAAN;IACD;EACF;;AAtDqD;;AAyDjD,MAAMuB,sBAAN,SAAqC3B,qBAArC,CAAoF;EACzFE,WAAW,CAACC,GAAD,EAAmBE,KAAnB,EAAmD;IAC5D,MAAMF,GAAN,EAAWyB,gBAAA,CAASC,kBAApB,EAAwCxB,KAAxC;EACD;;EAEDiB,WAAW,GAAG;IACZ,MAAM;MAAEL,MAAF;MAAUa,SAAV;MAAqBC;IAArB,IAA8B,KAAK1B,KAAzC;IACA,MAAMS,EAAE,GAAG,KAAKI,IAAL,CAAUX,UAAV,CAAqByB,YAArB,CAAkCf,MAAlC,EAA0Ca,SAA1C,EAAqDC,IAArD,CAAX;IACA,OAAO,KAAKlB,OAAL,CAAaC,EAAb,CAAP;EACD;;AATwF;;;;AAYpF,MAAMmB,oBAAN,SAAmCjC,qBAAnC,CAGL;EACAE,WAAW,CAACC,GAAD,EAAmBE,KAAnB,EAAiD;IAC1D,MAAMF,GAAN,EAAWyB,gBAAA,CAASM,gBAApB,EAAsC7B,KAAtC;EACD;;EAEDiB,WAAW,GAAG;IACZ,MAAM;MAAEa;IAAF,IAAa,KAAK9B,KAAxB;IACA,MAAM+B,IAAI,GAAG,IAAAC,sBAAA,EAAY,KAAKnB,IAAjB,EAAuB,KAAKb,KAAL,CAAW+B,IAAlC,CAAb;IACA,MAAMtB,EAAE,GAAG,KAAKI,IAAL,CAAUX,UAAV,CAAqB+B,UAArB,CAAgCH,MAAhC,EAAwCC,IAAxC,CAAX;;IACA,IAAItB,EAAE,KAAK,IAAX,EAAiB;MACf,OAAO,IAAP;IACD;;IACD,OAAO,KAAKD,OAAL,CAAaC,EAAb,CAAP;EACD;;AAbD;;;;AAgBK,MAAMyB,kBAAN,SAAiCvC,qBAAjC,CAA4E;EACjFE,WAAW,CAACC,GAAD,EAAmBE,KAAnB,EAA+C;IACxD,MAAMF,GAAN,EAAWyB,gBAAA,CAASY,cAApB,EAAoCnC,KAApC;EACD;;EAEDiB,WAAW,GAAG;IACZ,MAAM;MAAEmB,SAAF;MAAaC;IAAb,IAAuB,KAAKrC,KAAlC;IACA,MAAMS,EAAE,GAAG,KAAKI,IAAL,CAAUX,UAAV,CAAqBoC,QAArB,CAA8BF,SAA9B,EAAyCC,KAAzC,CAAX;IACA,OAAO,KAAK7B,OAAL,CAAaC,EAAb,CAAP;EACD;;AATgF;;;;AAY5E,MAAM8B,oBAAN,SAAmC5C,qBAAnC,CAGL;EACAE,WAAW,CAACC,GAAD,EAAmBE,KAAnB,EAAiD;IAC1D,MAAMF,GAAN,EAAWyB,gBAAA,CAASiB,gBAApB,EAAsCxC,KAAtC;EACD;;EAEDiB,WAAW,GAAG;IACZ,MAAM;MAAEwB;IAAF,IAAQ,KAAKzC,KAAnB;IACA,MAAMS,EAAE,GAAG,KAAKI,IAAL,CAAUX,UAAV,CAAqBwC,UAArB,CAAgCD,CAAhC,CAAX;;IACA,IAAIhC,EAAE,KAAK,IAAX,EAAiB;MACf,OAAO,IAAP;IACD;;IACD,OAAO,KAAKD,OAAL,CAAaC,EAAb,CAAP;EACD;;AAZD;;;;AAeK,MAAMkC,iBAAN,SAAgChD,qBAAhC,CAA4D;EACjEE,WAAW,CAACC,GAAD,EAAmB;IAC5B,MAAMA,GAAN,EAAWyB,gBAAA,CAASqB,aAApB,EAAmC,IAAnC;EACD;;EAED3B,WAAW,GAAG;IACZ,OAAO,KAAKJ,IAAL,CAAUX,UAAV,CAAqB2C,OAArB,CACL,KAAKzB,yBAAL,CAA+B,CAA/B,CADK,EAEL,KAAKA,yBAAL,CAA+B,CAA/B,CAFK,CAAP;EAID;;AAVgE;;;;AAa5D,MAAM0B,oBAAN,SAAmCnD,qBAAnC,CAGL;EACAE,WAAW,CAACC,GAAD,EAAmBE,KAAnB,EAAiD;IAC1D,MAAMF,GAAN,EAAWyB,gBAAA,CAASwB,gBAApB,EAAsC/C,KAAtC;EACD;;EAEDiB,WAAW,GAAG;IACZ,MAAM;MAAE+B,KAAF;MAASlB;IAAT,IAAoB,KAAK9B,KAA/B;IACA,MAAMS,EAAE,GAAG,KAAKI,IAAL,CAAUX,UAAV,CAAqB+C,UAArB,CAAgCD,KAAhC,EAAuClB,MAAvC,CAAX;;IACA,IAAIrB,EAAE,KAAK,IAAX,EAAiB;MACf,OAAO,IAAP;IACD;;IACD,OAAO,KAAKD,OAAL,CAAaC,EAAb,CAAP;EACD;;AAZD;;;;AAeK,MAAMyC,oBAAN,SAAmCvD,qBAAnC,CAGL;EACAE,WAAW,CAACC,GAAD,EAAmBE,KAAnB,EAAiD;IAC1D,MAAMF,GAAN,EAAWyB,gBAAA,CAAS4B,gBAApB,EAAsCnD,KAAtC;EACD;;EAEDiB,WAAW,GAAG;IACZ,MAAM;MAAEmC,OAAF;MAAWf,KAAX;MAAkBgB;IAAlB,IAA4B,KAAKrD,KAAvC;IACA,MAAM+B,IAAI,GAAG,IAAAC,sBAAA,EAAY,KAAKnB,IAAjB,EAAuB,KAAKb,KAAL,CAAW+B,IAAlC,CAAb;IACA,MAAMtB,EAAE,GAAG,KAAKI,IAAL,CAAUX,UAAV,CAAqBoD,UAArB,CACTvB,IADS,EAETqB,OAFS,EAGTf,KAHS,EAITkB,wBAAA,CAAkB,IAAAC,aAAA,EAAQH,KAAR,CAAlB,CAJS,CAAX;;IAMA,IAAI5C,EAAE,KAAK,IAAX,EAAiB;MACf,OAAO,IAAP;IACD;;IACD,OAAO,KAAKD,OAAL,CAAaC,EAAb,CAAP;EACD;;AAlBD"}