{"version":3,"names":["BlendNode","JsiDeclarationNode","constructor","ctx","props","DeclarationType","ImageFilter","NodeType","Blend","checkChild","child","_children","length","declarationType","Shader","addChild","Error","type","insertChildBefore","before","ImageFilterDeclaration","ShaderDeclaration","materialize","Skia","blend","BlendMode","enumKey","mode","reverse","reduce","inner","outer","MakeBlend"],"sources":["BlendNode.ts"],"sourcesContent":["import type { BlendProps } from \"../../types/ImageFilters\";\nimport type { SkShader, SkImageFilter } from \"../../../skia/types\";\nimport { BlendMode } from \"../../../skia/types\";\nimport { DeclarationType, NodeType } from \"../../types/NodeType\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport type { Node } from \"../../types\";\nimport { enumKey } from \"../datatypes\";\n\nimport { ImageFilterDeclaration } from \"./ImageFilters\";\nimport { ShaderDeclaration } from \"./Shaders\";\n\nexport class BlendNode extends JsiDeclarationNode<\n  BlendProps,\n  SkShader | SkImageFilter\n> {\n  constructor(ctx: NodeContext, props: BlendProps) {\n    super(ctx, DeclarationType.ImageFilter, NodeType.Blend, props);\n  }\n\n  private checkChild(\n    child: ImageFilterDeclaration<unknown> | ShaderDeclaration<unknown>\n  ) {\n    if (this._children.length > 0) {\n      if (child.declarationType === DeclarationType.ImageFilter) {\n        this.declarationType = DeclarationType.ImageFilter;\n      } else {\n        this.declarationType = DeclarationType.Shader;\n      }\n    }\n  }\n\n  addChild(child: Node<unknown>) {\n    if (\n      !(child instanceof JsiDeclarationNode) ||\n      (child.declarationType !== DeclarationType.Shader &&\n        child.declarationType !== DeclarationType.ImageFilter)\n    ) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    this.checkChild(child);\n    super.addChild(child);\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (\n      !(child instanceof ImageFilterDeclaration) ||\n      !(child instanceof ShaderDeclaration)\n    ) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    this.checkChild(child);\n    super.insertChildBefore(child, before);\n  }\n\n  materialize() {\n    const { Skia } = this;\n    const blend = BlendMode[enumKey(this.props.mode)];\n    if (this.declarationType === DeclarationType.ImageFilter) {\n      return (this._children as ImageFilterDeclaration<unknown>[])\n        .reverse()\n        .reduce<SkImageFilter | null>((inner, outer) => {\n          if (inner === null) {\n            return outer.materialize();\n          }\n          return Skia.ImageFilter.MakeBlend(blend, outer.materialize(), inner);\n        }, null) as SkImageFilter;\n    } else {\n      return (this._children as ShaderDeclaration<unknown>[])\n        .reverse()\n        .reduce<SkShader | null>((inner, outer) => {\n          if (inner === null) {\n            return outer.materialize();\n          }\n          return Skia.Shader.MakeBlend(blend, outer.materialize(), inner);\n        }, null) as SkShader;\n    }\n  }\n}\n"],"mappings":";;;;;;;AAEA;;AACA;;AAEA;;AAEA;;AAEA;;AACA;;AAEO,MAAMA,SAAN,SAAwBC,wBAAxB,CAGL;EACAC,WAAW,CAACC,GAAD,EAAmBC,KAAnB,EAAsC;IAC/C,MAAMD,GAAN,EAAWE,yBAAA,CAAgBC,WAA3B,EAAwCC,kBAAA,CAASC,KAAjD,EAAwDJ,KAAxD;EACD;;EAEOK,UAAU,CAChBC,KADgB,EAEhB;IACA,IAAI,KAAKC,SAAL,CAAeC,MAAf,GAAwB,CAA5B,EAA+B;MAC7B,IAAIF,KAAK,CAACG,eAAN,KAA0BR,yBAAA,CAAgBC,WAA9C,EAA2D;QACzD,KAAKO,eAAL,GAAuBR,yBAAA,CAAgBC,WAAvC;MACD,CAFD,MAEO;QACL,KAAKO,eAAL,GAAuBR,yBAAA,CAAgBS,MAAvC;MACD;IACF;EACF;;EAEDC,QAAQ,CAACL,KAAD,EAAuB;IAC7B,IACE,EAAEA,KAAK,YAAYT,wBAAnB,KACCS,KAAK,CAACG,eAAN,KAA0BR,yBAAA,CAAgBS,MAA1C,IACCJ,KAAK,CAACG,eAAN,KAA0BR,yBAAA,CAAgBC,WAH9C,EAIE;MACA,MAAM,IAAIU,KAAJ,CAAW,4BAA2BN,KAAK,CAACO,IAAK,OAAM,KAAKA,IAAK,EAAjE,CAAN;IACD;;IACD,KAAKR,UAAL,CAAgBC,KAAhB;IACA,MAAMK,QAAN,CAAeL,KAAf;EACD;;EAEDQ,iBAAiB,CAACR,KAAD,EAAuBS,MAAvB,EAAoD;IACnE,IACE,EAAET,KAAK,YAAYU,oCAAnB,KACA,EAAEV,KAAK,YAAYW,0BAAnB,CAFF,EAGE;MACA,MAAM,IAAIL,KAAJ,CAAW,4BAA2BN,KAAK,CAACO,IAAK,OAAM,KAAKA,IAAK,EAAjE,CAAN;IACD;;IACD,KAAKR,UAAL,CAAgBC,KAAhB;IACA,MAAMQ,iBAAN,CAAwBR,KAAxB,EAA+BS,MAA/B;EACD;;EAEDG,WAAW,GAAG;IACZ,MAAM;MAAEC;IAAF,IAAW,IAAjB;;IACA,MAAMC,KAAK,GAAGC,gBAAA,CAAU,IAAAC,kBAAA,EAAQ,KAAKtB,KAAL,CAAWuB,IAAnB,CAAV,CAAd;;IACA,IAAI,KAAKd,eAAL,KAAyBR,yBAAA,CAAgBC,WAA7C,EAA0D;MACxD,OAAQ,KAAKK,SAAN,CACJiB,OADI,GAEJC,MAFI,CAEyB,CAACC,KAAD,EAAQC,KAAR,KAAkB;QAC9C,IAAID,KAAK,KAAK,IAAd,EAAoB;UAClB,OAAOC,KAAK,CAACT,WAAN,EAAP;QACD;;QACD,OAAOC,IAAI,CAACjB,WAAL,CAAiB0B,SAAjB,CAA2BR,KAA3B,EAAkCO,KAAK,CAACT,WAAN,EAAlC,EAAuDQ,KAAvD,CAAP;MACD,CAPI,EAOF,IAPE,CAAP;IAQD,CATD,MASO;MACL,OAAQ,KAAKnB,SAAN,CACJiB,OADI,GAEJC,MAFI,CAEoB,CAACC,KAAD,EAAQC,KAAR,KAAkB;QACzC,IAAID,KAAK,KAAK,IAAd,EAAoB;UAClB,OAAOC,KAAK,CAACT,WAAN,EAAP;QACD;;QACD,OAAOC,IAAI,CAACT,MAAL,CAAYkB,SAAZ,CAAsBR,KAAtB,EAA6BO,KAAK,CAACT,WAAN,EAA7B,EAAkDQ,KAAlD,CAAP;MACD,CAPI,EAOF,IAPE,CAAP;IAQD;EACF;;AA9DD"}