{"version":3,"names":["paintProps","JsiRenderNode","JsiNode","constructor","ctx","type","props","matrix","Skia","Matrix","onPropChange","setProps","paintCache","setProp","key","value","hasChanged","includes","identity","clipPath","undefined","clipRect","clipRRect","computeMatrix","computeClip","addChild","child","JsiDeclarationNode","setInvalidate","insertChildBefore","before","clip","isPathDef","processPath","isRRect","processTransformProps","getPaintCtx","color","strokeWidth","blendMode","style","strokeJoin","strokeCap","strokeMiter","opacity","antiAlias","Color","BlendMode","enumKey","PaintStyle","StrokeJoin","StrokeCap","_children","forEach","isColorFilter","cf","materialize","colorFilter","ColorFilter","MakeCompose","isShader","shader","isPathEffect","pe","pathEffect","PathEffect","isImageFilter","filter","imageFilter","ImageFilter","isMaskFilter","maskFilter","render","parentCtx","invertClip","layer","transform","canvas","parent","paint","paintCtx","concatPaint","copy","hasTransform","hasClip","shouldSave","op","ClipOp","Difference","Intersect","saveLayer","save","concat","renderNode","restore","setAlphaf","getAlphaf","currentOpacity","setShader","setColor","setStrokeWidth","setAntiAlias","setBlendMode","setColorFilter","setImageFilter","setMaskFilter","setPathEffect","setStrokeCap","setStrokeJoin","setStrokeMiter","setStyle"],"sources":["RenderNode.ts"],"sourcesContent":["import type {\n  SkMatrix,\n  SkRect,\n  SkRRect,\n  SkPath,\n  SkPaint,\n} from \"../../skia/types\";\nimport {\n  StrokeCap,\n  StrokeJoin,\n  PaintStyle,\n  BlendMode,\n  ClipOp,\n  isRRect,\n} from \"../../skia/types\";\nimport type {\n  RenderNode,\n  GroupProps,\n  DrawingContext,\n  NodeType,\n  Node,\n} from \"../types\";\n\nimport { isPathDef, processPath, processTransformProps } from \"./datatypes\";\nimport type { NodeContext } from \"./Node\";\nimport { JsiNode, JsiDeclarationNode } from \"./Node\";\nimport type { PaintContext } from \"./PaintContext\";\nimport { enumKey } from \"./datatypes/Enum\";\n\nconst paintProps = [\n  \"color\",\n  \"strokeWidth\",\n  \"blendMode\",\n  \"strokeCap\",\n  \"strokeJoin\",\n  \"strokeMiter\",\n  \"style\",\n  \"antiAlias\",\n  \"opacity\",\n];\n\ninterface PaintCache {\n  parent: SkPaint;\n  child: SkPaint;\n}\n\nexport abstract class JsiRenderNode<P extends GroupProps>\n  extends JsiNode<P>\n  implements RenderNode<P>\n{\n  paintCache: PaintCache | null = null;\n  matrix: SkMatrix;\n  clipRect?: SkRect;\n  clipRRect?: SkRRect;\n  clipPath?: SkPath;\n\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, type, props);\n    this.matrix = this.Skia.Matrix();\n    this.onPropChange();\n  }\n\n  setProps(props: P) {\n    super.setProps(props);\n    this.onPropChange();\n    this.paintCache = null;\n  }\n\n  setProp<K extends keyof P>(key: K, value: P[K]) {\n    const hasChanged = super.setProp(key, value);\n    if (hasChanged) {\n      this.onPropChange();\n      if (paintProps.includes(key as string)) {\n        this.paintCache = null;\n      }\n    }\n    return hasChanged;\n  }\n\n  protected onPropChange() {\n    this.matrix.identity();\n    this.clipPath = undefined;\n    this.clipRect = undefined;\n    this.clipRRect = undefined;\n    this.computeMatrix();\n    this.computeClip();\n  }\n\n  addChild(child: Node<unknown>) {\n    if (child instanceof JsiDeclarationNode) {\n      child.setInvalidate(() => (this.paintCache = null));\n    }\n    super.addChild(child);\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>) {\n    if (child instanceof JsiDeclarationNode) {\n      child.setInvalidate(() => (this.paintCache = null));\n    }\n    super.insertChildBefore(child, before);\n  }\n\n  private computeClip() {\n    const { clip } = this.props;\n    if (clip) {\n      if (isPathDef(clip)) {\n        this.clipPath = processPath(this.Skia, clip);\n      } else if (isRRect(clip)) {\n        this.clipRRect = clip;\n      } else {\n        this.clipRect = clip;\n      }\n    }\n  }\n\n  private computeMatrix() {\n    processTransformProps(this.matrix, this.props);\n  }\n\n  private getPaintCtx() {\n    let ctx: PaintContext | undefined;\n    const {\n      color,\n      strokeWidth,\n      blendMode,\n      style,\n      strokeJoin,\n      strokeCap,\n      strokeMiter,\n      opacity,\n      antiAlias,\n    } = this.props;\n    if (\n      color !== undefined ||\n      strokeWidth !== undefined ||\n      blendMode !== undefined ||\n      style !== undefined ||\n      strokeJoin !== undefined ||\n      strokeCap !== undefined ||\n      strokeMiter !== undefined ||\n      opacity !== undefined ||\n      antiAlias !== undefined\n    ) {\n      ctx = { opacity: 1 };\n      if (color !== undefined) {\n        ctx.color = this.Skia.Color(color);\n      }\n      if (strokeWidth !== undefined) {\n        ctx.strokeWidth = strokeWidth;\n      }\n      if (blendMode !== undefined) {\n        ctx.blendMode = BlendMode[enumKey(blendMode)];\n      }\n      if (style !== undefined) {\n        ctx.style = PaintStyle[enumKey(style)];\n      }\n      if (strokeJoin !== undefined) {\n        ctx.strokeJoin = StrokeJoin[enumKey(strokeJoin)];\n      }\n      if (strokeCap !== undefined) {\n        ctx.strokeCap = StrokeCap[enumKey(strokeCap)];\n      }\n      if (strokeMiter !== undefined) {\n        ctx.strokeMiter = strokeMiter;\n      }\n      if (opacity !== undefined) {\n        ctx.opacity = opacity;\n      }\n      if (antiAlias !== undefined) {\n        ctx.antiAlias = antiAlias;\n      }\n    }\n    this._children.forEach((child) => {\n      if (child instanceof JsiDeclarationNode) {\n        if (child.isColorFilter()) {\n          ctx = ctx || {};\n          const cf = child.materialize();\n          ctx.colorFilter = ctx.colorFilter\n            ? this.Skia.ColorFilter.MakeCompose(cf, ctx.colorFilter)\n            : cf;\n        } else if (child.isShader()) {\n          ctx = ctx || {};\n          const shader = child.materialize();\n          ctx.shader = shader;\n        } else if (child.isPathEffect()) {\n          ctx = ctx || {};\n          const pe = child.materialize();\n          ctx.pathEffect = ctx.pathEffect\n            ? this.Skia.PathEffect.MakeCompose(pe, ctx.pathEffect)\n            : pe;\n        } else if (child.isImageFilter()) {\n          ctx = ctx || {};\n          const filter = child.materialize();\n          ctx.imageFilter = ctx.imageFilter\n            ? this.Skia.ImageFilter.MakeCompose(filter, ctx.imageFilter)\n            : filter;\n        } else if (child.isMaskFilter()) {\n          ctx = ctx || {};\n          const filter = child.materialize();\n          ctx.maskFilter = filter;\n        }\n      }\n    });\n    return ctx;\n  }\n\n  render(parentCtx: DrawingContext) {\n    const { invertClip, layer, matrix, transform } = this.props;\n    const { canvas } = parentCtx;\n\n    if (\n      this.paintCache === null ||\n      this.paintCache.parent !== parentCtx.paint\n    ) {\n      const paintCtx = this.getPaintCtx();\n      const child = paintCtx\n        ? concatPaint(parentCtx.paint.copy(), paintCtx)\n        : parentCtx.paint;\n      this.paintCache = { parent: parentCtx.paint, child };\n    }\n    const paint = this.paintCache.child;\n    // TODO: can we only recreate a new context here if needed?\n    const ctx = { ...parentCtx, paint };\n    const hasTransform = matrix !== undefined || transform !== undefined;\n    const hasClip =\n      this.clipRect !== undefined ||\n      this.clipPath !== undefined ||\n      this.clipRRect !== undefined;\n    const shouldSave = hasTransform || hasClip || !!layer;\n    const op = invertClip ? ClipOp.Difference : ClipOp.Intersect;\n    if (shouldSave) {\n      if (layer) {\n        if (typeof layer === \"boolean\") {\n          canvas.saveLayer();\n        } else {\n          canvas.saveLayer(layer);\n        }\n      } else {\n        canvas.save();\n      }\n    }\n\n    if (this.matrix) {\n      canvas.concat(this.matrix);\n    }\n    if (this.clipRect) {\n      canvas.clipRect(this.clipRect, op, true);\n    } else if (this.clipRRect) {\n      canvas.clipRRect(this.clipRRect, op, true);\n    } else if (this.clipPath) {\n      canvas.clipPath(this.clipPath, op, true);\n    }\n\n    this.renderNode(ctx);\n\n    if (shouldSave) {\n      canvas.restore();\n    }\n  }\n\n  abstract renderNode(ctx: DrawingContext): void;\n}\n\nconst concatPaint = (\n  paint: SkPaint,\n  {\n    color,\n    strokeWidth,\n    shader,\n    antiAlias,\n    blendMode,\n    colorFilter,\n    imageFilter,\n    maskFilter,\n    pathEffect,\n    opacity,\n    strokeCap,\n    strokeJoin,\n    strokeMiter,\n    style,\n  }: PaintContext\n) => {\n  if (opacity !== undefined) {\n    paint.setAlphaf(paint.getAlphaf() * opacity);\n  }\n  if (color !== undefined) {\n    const currentOpacity = paint.getAlphaf();\n    paint.setShader(null);\n    paint.setColor(color);\n    paint.setAlphaf(currentOpacity * paint.getAlphaf());\n  }\n  if (strokeWidth !== undefined) {\n    paint.setStrokeWidth(strokeWidth);\n  }\n  if (shader !== undefined) {\n    paint.setShader(shader);\n  }\n  if (antiAlias !== undefined) {\n    paint.setAntiAlias(antiAlias);\n  }\n  if (blendMode !== undefined) {\n    paint.setBlendMode(blendMode);\n  }\n  if (colorFilter !== undefined) {\n    paint.setColorFilter(colorFilter);\n  }\n  if (imageFilter !== undefined) {\n    paint.setImageFilter(imageFilter);\n  }\n  if (maskFilter !== undefined) {\n    paint.setMaskFilter(maskFilter);\n  }\n  if (pathEffect !== undefined) {\n    paint.setPathEffect(pathEffect);\n  }\n  if (strokeCap !== undefined) {\n    paint.setStrokeCap(strokeCap);\n  }\n  if (strokeJoin !== undefined) {\n    paint.setStrokeJoin(strokeJoin);\n  }\n  if (strokeMiter !== undefined) {\n    paint.setStrokeMiter(strokeMiter);\n  }\n  if (style !== undefined) {\n    paint.setStyle(style);\n  }\n  return paint;\n};\n"],"mappings":";;;;;;;AAOA;;AAgBA;;AAEA;;AAEA;;;;AAEA,MAAMA,UAAU,GAAG,CACjB,OADiB,EAEjB,aAFiB,EAGjB,WAHiB,EAIjB,WAJiB,EAKjB,YALiB,EAMjB,aANiB,EAOjB,OAPiB,EAQjB,WARiB,EASjB,SATiB,CAAnB;;AAiBO,MAAeC,aAAf,SACGC,aADH,CAGP;EAOEC,WAAW,CAACC,GAAD,EAAmBC,IAAnB,EAAmCC,KAAnC,EAA6C;IACtD,MAAMF,GAAN,EAAWC,IAAX,EAAiBC,KAAjB;;IADsD,oCANxB,IAMwB;;IAAA;;IAAA;;IAAA;;IAAA;;IAEtD,KAAKC,MAAL,GAAc,KAAKC,IAAL,CAAUC,MAAV,EAAd;IACA,KAAKC,YAAL;EACD;;EAEDC,QAAQ,CAACL,KAAD,EAAW;IACjB,MAAMK,QAAN,CAAeL,KAAf;IACA,KAAKI,YAAL;IACA,KAAKE,UAAL,GAAkB,IAAlB;EACD;;EAEDC,OAAO,CAAoBC,GAApB,EAA4BC,KAA5B,EAAyC;IAC9C,MAAMC,UAAU,GAAG,MAAMH,OAAN,CAAcC,GAAd,EAAmBC,KAAnB,CAAnB;;IACA,IAAIC,UAAJ,EAAgB;MACd,KAAKN,YAAL;;MACA,IAAIV,UAAU,CAACiB,QAAX,CAAoBH,GAApB,CAAJ,EAAwC;QACtC,KAAKF,UAAL,GAAkB,IAAlB;MACD;IACF;;IACD,OAAOI,UAAP;EACD;;EAESN,YAAY,GAAG;IACvB,KAAKH,MAAL,CAAYW,QAAZ;IACA,KAAKC,QAAL,GAAgBC,SAAhB;IACA,KAAKC,QAAL,GAAgBD,SAAhB;IACA,KAAKE,SAAL,GAAiBF,SAAjB;IACA,KAAKG,aAAL;IACA,KAAKC,WAAL;EACD;;EAEDC,QAAQ,CAACC,KAAD,EAAuB;IAC7B,IAAIA,KAAK,YAAYC,wBAArB,EAAyC;MACvCD,KAAK,CAACE,aAAN,CAAoB,MAAO,KAAKhB,UAAL,GAAkB,IAA7C;IACD;;IACD,MAAMa,QAAN,CAAeC,KAAf;EACD;;EAEDG,iBAAiB,CAACH,KAAD,EAAuBI,MAAvB,EAA8C;IAC7D,IAAIJ,KAAK,YAAYC,wBAArB,EAAyC;MACvCD,KAAK,CAACE,aAAN,CAAoB,MAAO,KAAKhB,UAAL,GAAkB,IAA7C;IACD;;IACD,MAAMiB,iBAAN,CAAwBH,KAAxB,EAA+BI,MAA/B;EACD;;EAEON,WAAW,GAAG;IACpB,MAAM;MAAEO;IAAF,IAAW,KAAKzB,KAAtB;;IACA,IAAIyB,IAAJ,EAAU;MACR,IAAI,IAAAC,oBAAA,EAAUD,IAAV,CAAJ,EAAqB;QACnB,KAAKZ,QAAL,GAAgB,IAAAc,sBAAA,EAAY,KAAKzB,IAAjB,EAAuBuB,IAAvB,CAAhB;MACD,CAFD,MAEO,IAAI,IAAAG,cAAA,EAAQH,IAAR,CAAJ,EAAmB;QACxB,KAAKT,SAAL,GAAiBS,IAAjB;MACD,CAFM,MAEA;QACL,KAAKV,QAAL,GAAgBU,IAAhB;MACD;IACF;EACF;;EAEOR,aAAa,GAAG;IACtB,IAAAY,gCAAA,EAAsB,KAAK5B,MAA3B,EAAmC,KAAKD,KAAxC;EACD;;EAEO8B,WAAW,GAAG;IACpB,IAAIhC,GAAJ;IACA,MAAM;MACJiC,KADI;MAEJC,WAFI;MAGJC,SAHI;MAIJC,KAJI;MAKJC,UALI;MAMJC,SANI;MAOJC,WAPI;MAQJC,OARI;MASJC;IATI,IAUF,KAAKvC,KAVT;;IAWA,IACE+B,KAAK,KAAKjB,SAAV,IACAkB,WAAW,KAAKlB,SADhB,IAEAmB,SAAS,KAAKnB,SAFd,IAGAoB,KAAK,KAAKpB,SAHV,IAIAqB,UAAU,KAAKrB,SAJf,IAKAsB,SAAS,KAAKtB,SALd,IAMAuB,WAAW,KAAKvB,SANhB,IAOAwB,OAAO,KAAKxB,SAPZ,IAQAyB,SAAS,KAAKzB,SAThB,EAUE;MACAhB,GAAG,GAAG;QAAEwC,OAAO,EAAE;MAAX,CAAN;;MACA,IAAIP,KAAK,KAAKjB,SAAd,EAAyB;QACvBhB,GAAG,CAACiC,KAAJ,GAAY,KAAK7B,IAAL,CAAUsC,KAAV,CAAgBT,KAAhB,CAAZ;MACD;;MACD,IAAIC,WAAW,KAAKlB,SAApB,EAA+B;QAC7BhB,GAAG,CAACkC,WAAJ,GAAkBA,WAAlB;MACD;;MACD,IAAIC,SAAS,KAAKnB,SAAlB,EAA6B;QAC3BhB,GAAG,CAACmC,SAAJ,GAAgBQ,gBAAA,CAAU,IAAAC,aAAA,EAAQT,SAAR,CAAV,CAAhB;MACD;;MACD,IAAIC,KAAK,KAAKpB,SAAd,EAAyB;QACvBhB,GAAG,CAACoC,KAAJ,GAAYS,iBAAA,CAAW,IAAAD,aAAA,EAAQR,KAAR,CAAX,CAAZ;MACD;;MACD,IAAIC,UAAU,KAAKrB,SAAnB,EAA8B;QAC5BhB,GAAG,CAACqC,UAAJ,GAAiBS,iBAAA,CAAW,IAAAF,aAAA,EAAQP,UAAR,CAAX,CAAjB;MACD;;MACD,IAAIC,SAAS,KAAKtB,SAAlB,EAA6B;QAC3BhB,GAAG,CAACsC,SAAJ,GAAgBS,gBAAA,CAAU,IAAAH,aAAA,EAAQN,SAAR,CAAV,CAAhB;MACD;;MACD,IAAIC,WAAW,KAAKvB,SAApB,EAA+B;QAC7BhB,GAAG,CAACuC,WAAJ,GAAkBA,WAAlB;MACD;;MACD,IAAIC,OAAO,KAAKxB,SAAhB,EAA2B;QACzBhB,GAAG,CAACwC,OAAJ,GAAcA,OAAd;MACD;;MACD,IAAIC,SAAS,KAAKzB,SAAlB,EAA6B;QAC3BhB,GAAG,CAACyC,SAAJ,GAAgBA,SAAhB;MACD;IACF;;IACD,KAAKO,SAAL,CAAeC,OAAf,CAAwB3B,KAAD,IAAW;MAChC,IAAIA,KAAK,YAAYC,wBAArB,EAAyC;QACvC,IAAID,KAAK,CAAC4B,aAAN,EAAJ,EAA2B;UACzBlD,GAAG,GAAGA,GAAG,IAAI,EAAb;UACA,MAAMmD,EAAE,GAAG7B,KAAK,CAAC8B,WAAN,EAAX;UACApD,GAAG,CAACqD,WAAJ,GAAkBrD,GAAG,CAACqD,WAAJ,GACd,KAAKjD,IAAL,CAAUkD,WAAV,CAAsBC,WAAtB,CAAkCJ,EAAlC,EAAsCnD,GAAG,CAACqD,WAA1C,CADc,GAEdF,EAFJ;QAGD,CAND,MAMO,IAAI7B,KAAK,CAACkC,QAAN,EAAJ,EAAsB;UAC3BxD,GAAG,GAAGA,GAAG,IAAI,EAAb;UACA,MAAMyD,MAAM,GAAGnC,KAAK,CAAC8B,WAAN,EAAf;UACApD,GAAG,CAACyD,MAAJ,GAAaA,MAAb;QACD,CAJM,MAIA,IAAInC,KAAK,CAACoC,YAAN,EAAJ,EAA0B;UAC/B1D,GAAG,GAAGA,GAAG,IAAI,EAAb;UACA,MAAM2D,EAAE,GAAGrC,KAAK,CAAC8B,WAAN,EAAX;UACApD,GAAG,CAAC4D,UAAJ,GAAiB5D,GAAG,CAAC4D,UAAJ,GACb,KAAKxD,IAAL,CAAUyD,UAAV,CAAqBN,WAArB,CAAiCI,EAAjC,EAAqC3D,GAAG,CAAC4D,UAAzC,CADa,GAEbD,EAFJ;QAGD,CANM,MAMA,IAAIrC,KAAK,CAACwC,aAAN,EAAJ,EAA2B;UAChC9D,GAAG,GAAGA,GAAG,IAAI,EAAb;UACA,MAAM+D,MAAM,GAAGzC,KAAK,CAAC8B,WAAN,EAAf;UACApD,GAAG,CAACgE,WAAJ,GAAkBhE,GAAG,CAACgE,WAAJ,GACd,KAAK5D,IAAL,CAAU6D,WAAV,CAAsBV,WAAtB,CAAkCQ,MAAlC,EAA0C/D,GAAG,CAACgE,WAA9C,CADc,GAEdD,MAFJ;QAGD,CANM,MAMA,IAAIzC,KAAK,CAAC4C,YAAN,EAAJ,EAA0B;UAC/BlE,GAAG,GAAGA,GAAG,IAAI,EAAb;UACA,MAAM+D,MAAM,GAAGzC,KAAK,CAAC8B,WAAN,EAAf;UACApD,GAAG,CAACmE,UAAJ,GAAiBJ,MAAjB;QACD;MACF;IACF,CA9BD;;IA+BA,OAAO/D,GAAP;EACD;;EAEDoE,MAAM,CAACC,SAAD,EAA4B;IAChC,MAAM;MAAEC,UAAF;MAAcC,KAAd;MAAqBpE,MAArB;MAA6BqE;IAA7B,IAA2C,KAAKtE,KAAtD;IACA,MAAM;MAAEuE;IAAF,IAAaJ,SAAnB;;IAEA,IACE,KAAK7D,UAAL,KAAoB,IAApB,IACA,KAAKA,UAAL,CAAgBkE,MAAhB,KAA2BL,SAAS,CAACM,KAFvC,EAGE;MACA,MAAMC,QAAQ,GAAG,KAAK5C,WAAL,EAAjB;MACA,MAAMV,KAAK,GAAGsD,QAAQ,GAClBC,WAAW,CAACR,SAAS,CAACM,KAAV,CAAgBG,IAAhB,EAAD,EAAyBF,QAAzB,CADO,GAElBP,SAAS,CAACM,KAFd;MAGA,KAAKnE,UAAL,GAAkB;QAAEkE,MAAM,EAAEL,SAAS,CAACM,KAApB;QAA2BrD;MAA3B,CAAlB;IACD;;IACD,MAAMqD,KAAK,GAAG,KAAKnE,UAAL,CAAgBc,KAA9B,CAdgC,CAehC;;IACA,MAAMtB,GAAG,GAAG,EAAE,GAAGqE,SAAL;MAAgBM;IAAhB,CAAZ;IACA,MAAMI,YAAY,GAAG5E,MAAM,KAAKa,SAAX,IAAwBwD,SAAS,KAAKxD,SAA3D;IACA,MAAMgE,OAAO,GACX,KAAK/D,QAAL,KAAkBD,SAAlB,IACA,KAAKD,QAAL,KAAkBC,SADlB,IAEA,KAAKE,SAAL,KAAmBF,SAHrB;IAIA,MAAMiE,UAAU,GAAGF,YAAY,IAAIC,OAAhB,IAA2B,CAAC,CAACT,KAAhD;IACA,MAAMW,EAAE,GAAGZ,UAAU,GAAGa,aAAA,CAAOC,UAAV,GAAuBD,aAAA,CAAOE,SAAnD;;IACA,IAAIJ,UAAJ,EAAgB;MACd,IAAIV,KAAJ,EAAW;QACT,IAAI,OAAOA,KAAP,KAAiB,SAArB,EAAgC;UAC9BE,MAAM,CAACa,SAAP;QACD,CAFD,MAEO;UACLb,MAAM,CAACa,SAAP,CAAiBf,KAAjB;QACD;MACF,CAND,MAMO;QACLE,MAAM,CAACc,IAAP;MACD;IACF;;IAED,IAAI,KAAKpF,MAAT,EAAiB;MACfsE,MAAM,CAACe,MAAP,CAAc,KAAKrF,MAAnB;IACD;;IACD,IAAI,KAAKc,QAAT,EAAmB;MACjBwD,MAAM,CAACxD,QAAP,CAAgB,KAAKA,QAArB,EAA+BiE,EAA/B,EAAmC,IAAnC;IACD,CAFD,MAEO,IAAI,KAAKhE,SAAT,EAAoB;MACzBuD,MAAM,CAACvD,SAAP,CAAiB,KAAKA,SAAtB,EAAiCgE,EAAjC,EAAqC,IAArC;IACD,CAFM,MAEA,IAAI,KAAKnE,QAAT,EAAmB;MACxB0D,MAAM,CAAC1D,QAAP,CAAgB,KAAKA,QAArB,EAA+BmE,EAA/B,EAAmC,IAAnC;IACD;;IAED,KAAKO,UAAL,CAAgBzF,GAAhB;;IAEA,IAAIiF,UAAJ,EAAgB;MACdR,MAAM,CAACiB,OAAP;IACD;EACF;;AAjNH;;;;AAsNA,MAAMb,WAAW,GAAG,CAClBF,KADkB,WAkBf;EAAA,IAhBH;IACE1C,KADF;IAEEC,WAFF;IAGEuB,MAHF;IAIEhB,SAJF;IAKEN,SALF;IAMEkB,WANF;IAOEW,WAPF;IAQEG,UARF;IASEP,UATF;IAUEpB,OAVF;IAWEF,SAXF;IAYED,UAZF;IAaEE,WAbF;IAcEH;EAdF,CAgBG;;EACH,IAAII,OAAO,KAAKxB,SAAhB,EAA2B;IACzB2D,KAAK,CAACgB,SAAN,CAAgBhB,KAAK,CAACiB,SAAN,KAAoBpD,OAApC;EACD;;EACD,IAAIP,KAAK,KAAKjB,SAAd,EAAyB;IACvB,MAAM6E,cAAc,GAAGlB,KAAK,CAACiB,SAAN,EAAvB;IACAjB,KAAK,CAACmB,SAAN,CAAgB,IAAhB;IACAnB,KAAK,CAACoB,QAAN,CAAe9D,KAAf;IACA0C,KAAK,CAACgB,SAAN,CAAgBE,cAAc,GAAGlB,KAAK,CAACiB,SAAN,EAAjC;EACD;;EACD,IAAI1D,WAAW,KAAKlB,SAApB,EAA+B;IAC7B2D,KAAK,CAACqB,cAAN,CAAqB9D,WAArB;EACD;;EACD,IAAIuB,MAAM,KAAKzC,SAAf,EAA0B;IACxB2D,KAAK,CAACmB,SAAN,CAAgBrC,MAAhB;EACD;;EACD,IAAIhB,SAAS,KAAKzB,SAAlB,EAA6B;IAC3B2D,KAAK,CAACsB,YAAN,CAAmBxD,SAAnB;EACD;;EACD,IAAIN,SAAS,KAAKnB,SAAlB,EAA6B;IAC3B2D,KAAK,CAACuB,YAAN,CAAmB/D,SAAnB;EACD;;EACD,IAAIkB,WAAW,KAAKrC,SAApB,EAA+B;IAC7B2D,KAAK,CAACwB,cAAN,CAAqB9C,WAArB;EACD;;EACD,IAAIW,WAAW,KAAKhD,SAApB,EAA+B;IAC7B2D,KAAK,CAACyB,cAAN,CAAqBpC,WAArB;EACD;;EACD,IAAIG,UAAU,KAAKnD,SAAnB,EAA8B;IAC5B2D,KAAK,CAAC0B,aAAN,CAAoBlC,UAApB;EACD;;EACD,IAAIP,UAAU,KAAK5C,SAAnB,EAA8B;IAC5B2D,KAAK,CAAC2B,aAAN,CAAoB1C,UAApB;EACD;;EACD,IAAItB,SAAS,KAAKtB,SAAlB,EAA6B;IAC3B2D,KAAK,CAAC4B,YAAN,CAAmBjE,SAAnB;EACD;;EACD,IAAID,UAAU,KAAKrB,SAAnB,EAA8B;IAC5B2D,KAAK,CAAC6B,aAAN,CAAoBnE,UAApB;EACD;;EACD,IAAIE,WAAW,KAAKvB,SAApB,EAA+B;IAC7B2D,KAAK,CAAC8B,cAAN,CAAqBlE,WAArB;EACD;;EACD,IAAIH,KAAK,KAAKpB,SAAd,EAAyB;IACvB2D,KAAK,CAAC+B,QAAN,CAAetE,KAAf;EACD;;EACD,OAAOuC,KAAP;AACD,CAjED"}