{"version":3,"names":["Path1DEffectStyle","JsiDeclarationNode","DeclarationType","NodeType","enumKey","processPath","PathEffectDeclaration","constructor","ctx","type","props","PathEffect","addChild","child","Error","insertChildBefore","before","compose","pe","children","_children","length","Skia","MakeCompose","reduce","acc","materialize","getOptionalChildInstance","index","getMandatoryChildInstance","isPathEffect","DiscretePathEffectNode","DiscretePathEffect","deviation","seed","MakeDiscrete","Path2DPathEffectNode","Path2DPathEffect","matrix","path","MakePath2D","DashPathEffectNode","DashPathEffect","intervals","phase","MakeDash","CornerPathEffectNode","CornerPathEffect","r","MakeCorner","SumPathEffectNode","SumPathEffect","MakeSum","Line2DPathEffectNode","Line2DPathEffect","width","MakeLine2D","Path1DPathEffectNode","Path1DPathEffect","advance","style","MakePath1D"],"sources":["PathEffects.ts"],"sourcesContent":["import { Path1DEffectStyle } from \"../../../skia/types\";\nimport type { SkPathEffect } from \"../../../skia/types\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport type {\n  CornerPathEffectProps,\n  DashPathEffectProps,\n  DiscretePathEffectProps,\n  Line2DPathEffectProps,\n  Node,\n  Path1DPathEffectProps,\n  Path2DPathEffectProps,\n} from \"../../types\";\nimport { DeclarationType, NodeType } from \"../../types\";\nimport { enumKey } from \"../datatypes/Enum\";\nimport { processPath } from \"../datatypes\";\n\nabstract class PathEffectDeclaration<\n  P,\n  Nullable extends null | never = never\n> extends JsiDeclarationNode<P, SkPathEffect, Nullable> {\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, DeclarationType.PathEffect, type, props);\n  }\n\n  addChild(child: Node<unknown>) {\n    if (!(child instanceof PathEffectDeclaration)) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    super.addChild(child);\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (!(child instanceof PathEffectDeclaration)) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    super.insertChildBefore(child, before);\n  }\n\n  compose(pe: SkPathEffect) {\n    const children = this._children as PathEffectDeclaration<unknown>[];\n    if (this._children.length === 0) {\n      return pe;\n    } else {\n      return this.Skia.PathEffect.MakeCompose(\n        pe,\n        children.reduce<SkPathEffect | null>((acc, child) => {\n          if (acc === null) {\n            return child.materialize();\n          }\n          return this.Skia.PathEffect.MakeCompose(acc, child.materialize());\n        }, null) as SkPathEffect\n      );\n    }\n  }\n  getOptionalChildInstance(index: number) {\n    const child = this._children[index];\n    if (!child) {\n      return null;\n    }\n    return this.getMandatoryChildInstance(index);\n  }\n\n  getMandatoryChildInstance(index: number) {\n    const child = this._children[index];\n    if (child instanceof JsiDeclarationNode) {\n      if (child.isPathEffect()) {\n        return child.materialize();\n      } else {\n        throw new Error(`Found invalid child ${child.type} in ${this.type}`);\n      }\n    } else {\n      throw new Error(`Found invalid child ${child.type} in ${this.type}`);\n    }\n  }\n}\n\nexport class DiscretePathEffectNode extends PathEffectDeclaration<DiscretePathEffectProps> {\n  constructor(ctx: NodeContext, props: DiscretePathEffectProps) {\n    super(ctx, NodeType.DiscretePathEffect, props);\n  }\n\n  materialize() {\n    const { length, deviation, seed } = this.props;\n    const pe = this.Skia.PathEffect.MakeDiscrete(length, deviation, seed);\n    return this.compose(pe);\n  }\n}\n\nexport class Path2DPathEffectNode extends PathEffectDeclaration<\n  Path2DPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: Path2DPathEffectProps) {\n    super(ctx, NodeType.Path2DPathEffect, props);\n  }\n\n  materialize() {\n    const { matrix } = this.props;\n    const path = processPath(this.Skia, this.props.path);\n    const pe = this.Skia.PathEffect.MakePath2D(matrix, path);\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n\nexport class DashPathEffectNode extends PathEffectDeclaration<DashPathEffectProps> {\n  constructor(ctx: NodeContext, props: DashPathEffectProps) {\n    super(ctx, NodeType.DashPathEffect, props);\n  }\n\n  materialize() {\n    const { intervals, phase } = this.props;\n    const pe = this.Skia.PathEffect.MakeDash(intervals, phase);\n    return this.compose(pe);\n  }\n}\n\nexport class CornerPathEffectNode extends PathEffectDeclaration<\n  CornerPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: CornerPathEffectProps) {\n    super(ctx, NodeType.CornerPathEffect, props);\n  }\n\n  materialize() {\n    const { r } = this.props;\n    const pe = this.Skia.PathEffect.MakeCorner(r);\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n\nexport class SumPathEffectNode extends PathEffectDeclaration<null> {\n  constructor(ctx: NodeContext) {\n    super(ctx, NodeType.SumPathEffect, null);\n  }\n\n  materialize() {\n    return this.Skia.PathEffect.MakeSum(\n      this.getMandatoryChildInstance(0),\n      this.getMandatoryChildInstance(1)\n    );\n  }\n}\n\nexport class Line2DPathEffectNode extends PathEffectDeclaration<\n  Line2DPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: Line2DPathEffectProps) {\n    super(ctx, NodeType.Line2DPathEffect, props);\n  }\n\n  materialize() {\n    const { width, matrix } = this.props;\n    const pe = this.Skia.PathEffect.MakeLine2D(width, matrix);\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n\nexport class Path1DPathEffectNode extends PathEffectDeclaration<\n  Path1DPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: Path1DPathEffectProps) {\n    super(ctx, NodeType.Path1DPathEffect, props);\n  }\n\n  materialize() {\n    const { advance, phase, style } = this.props;\n    const path = processPath(this.Skia, this.props.path);\n    const pe = this.Skia.PathEffect.MakePath1D(\n      path,\n      advance,\n      phase,\n      Path1DEffectStyle[enumKey(style)]\n    );\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n"],"mappings":"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"}