{"version":3,"names":["BlendMode","DeclarationType","NodeType","JsiDeclarationNode","enumKey","ImageFilterDeclaration","ShaderDeclaration","BlendNode","constructor","ctx","props","ImageFilter","Blend","checkChild","child","_children","length","declarationType","Shader","addChild","Error","type","insertChildBefore","before","materialize","Skia","blend","mode","reverse","reduce","inner","outer","MakeBlend"],"sources":["BlendNode.ts"],"sourcesContent":["import type { BlendProps } from \"../../types/ImageFilters\";\nimport type { SkShader, SkImageFilter } from \"../../../skia/types\";\nimport { BlendMode } from \"../../../skia/types\";\nimport { DeclarationType, NodeType } from \"../../types/NodeType\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport type { Node } from \"../../types\";\nimport { enumKey } from \"../datatypes\";\n\nimport { ImageFilterDeclaration } from \"./ImageFilters\";\nimport { ShaderDeclaration } from \"./Shaders\";\n\nexport class BlendNode extends JsiDeclarationNode<\n  BlendProps,\n  SkShader | SkImageFilter\n> {\n  constructor(ctx: NodeContext, props: BlendProps) {\n    super(ctx, DeclarationType.ImageFilter, NodeType.Blend, props);\n  }\n\n  private checkChild(\n    child: ImageFilterDeclaration<unknown> | ShaderDeclaration<unknown>\n  ) {\n    if (this._children.length > 0) {\n      if (child.declarationType === DeclarationType.ImageFilter) {\n        this.declarationType = DeclarationType.ImageFilter;\n      } else {\n        this.declarationType = DeclarationType.Shader;\n      }\n    }\n  }\n\n  addChild(child: Node<unknown>) {\n    if (\n      !(child instanceof JsiDeclarationNode) ||\n      (child.declarationType !== DeclarationType.Shader &&\n        child.declarationType !== DeclarationType.ImageFilter)\n    ) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    this.checkChild(child);\n    super.addChild(child);\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (\n      !(child instanceof ImageFilterDeclaration) ||\n      !(child instanceof ShaderDeclaration)\n    ) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    this.checkChild(child);\n    super.insertChildBefore(child, before);\n  }\n\n  materialize() {\n    const { Skia } = this;\n    const blend = BlendMode[enumKey(this.props.mode)];\n    if (this.declarationType === DeclarationType.ImageFilter) {\n      return (this._children as ImageFilterDeclaration<unknown>[])\n        .reverse()\n        .reduce<SkImageFilter | null>((inner, outer) => {\n          if (inner === null) {\n            return outer.materialize();\n          }\n          return Skia.ImageFilter.MakeBlend(blend, outer.materialize(), inner);\n        }, null) as SkImageFilter;\n    } else {\n      return (this._children as ShaderDeclaration<unknown>[])\n        .reverse()\n        .reduce<SkShader | null>((inner, outer) => {\n          if (inner === null) {\n            return outer.materialize();\n          }\n          return Skia.Shader.MakeBlend(blend, outer.materialize(), inner);\n        }, null) as SkShader;\n    }\n  }\n}\n"],"mappings":"AAEA,SAASA,SAAT,QAA0B,qBAA1B;AACA,SAASC,eAAT,EAA0BC,QAA1B,QAA0C,sBAA1C;AAEA,SAASC,kBAAT,QAAmC,SAAnC;AAEA,SAASC,OAAT,QAAwB,cAAxB;AAEA,SAASC,sBAAT,QAAuC,gBAAvC;AACA,SAASC,iBAAT,QAAkC,WAAlC;AAEA,OAAO,MAAMC,SAAN,SAAwBJ,kBAAxB,CAGL;EACAK,WAAW,CAACC,GAAD,EAAmBC,KAAnB,EAAsC;IAC/C,MAAMD,GAAN,EAAWR,eAAe,CAACU,WAA3B,EAAwCT,QAAQ,CAACU,KAAjD,EAAwDF,KAAxD;EACD;;EAEOG,UAAU,CAChBC,KADgB,EAEhB;IACA,IAAI,KAAKC,SAAL,CAAeC,MAAf,GAAwB,CAA5B,EAA+B;MAC7B,IAAIF,KAAK,CAACG,eAAN,KAA0BhB,eAAe,CAACU,WAA9C,EAA2D;QACzD,KAAKM,eAAL,GAAuBhB,eAAe,CAACU,WAAvC;MACD,CAFD,MAEO;QACL,KAAKM,eAAL,GAAuBhB,eAAe,CAACiB,MAAvC;MACD;IACF;EACF;;EAEDC,QAAQ,CAACL,KAAD,EAAuB;IAC7B,IACE,EAAEA,KAAK,YAAYX,kBAAnB,KACCW,KAAK,CAACG,eAAN,KAA0BhB,eAAe,CAACiB,MAA1C,IACCJ,KAAK,CAACG,eAAN,KAA0BhB,eAAe,CAACU,WAH9C,EAIE;MACA,MAAM,IAAIS,KAAJ,CAAW,4BAA2BN,KAAK,CAACO,IAAK,OAAM,KAAKA,IAAK,EAAjE,CAAN;IACD;;IACD,KAAKR,UAAL,CAAgBC,KAAhB;IACA,MAAMK,QAAN,CAAeL,KAAf;EACD;;EAEDQ,iBAAiB,CAACR,KAAD,EAAuBS,MAAvB,EAAoD;IACnE,IACE,EAAET,KAAK,YAAYT,sBAAnB,KACA,EAAES,KAAK,YAAYR,iBAAnB,CAFF,EAGE;MACA,MAAM,IAAIc,KAAJ,CAAW,4BAA2BN,KAAK,CAACO,IAAK,OAAM,KAAKA,IAAK,EAAjE,CAAN;IACD;;IACD,KAAKR,UAAL,CAAgBC,KAAhB;IACA,MAAMQ,iBAAN,CAAwBR,KAAxB,EAA+BS,MAA/B;EACD;;EAEDC,WAAW,GAAG;IACZ,MAAM;MAAEC;IAAF,IAAW,IAAjB;IACA,MAAMC,KAAK,GAAG1B,SAAS,CAACI,OAAO,CAAC,KAAKM,KAAL,CAAWiB,IAAZ,CAAR,CAAvB;;IACA,IAAI,KAAKV,eAAL,KAAyBhB,eAAe,CAACU,WAA7C,EAA0D;MACxD,OAAQ,KAAKI,SAAN,CACJa,OADI,GAEJC,MAFI,CAEyB,CAACC,KAAD,EAAQC,KAAR,KAAkB;QAC9C,IAAID,KAAK,KAAK,IAAd,EAAoB;UAClB,OAAOC,KAAK,CAACP,WAAN,EAAP;QACD;;QACD,OAAOC,IAAI,CAACd,WAAL,CAAiBqB,SAAjB,CAA2BN,KAA3B,EAAkCK,KAAK,CAACP,WAAN,EAAlC,EAAuDM,KAAvD,CAAP;MACD,CAPI,EAOF,IAPE,CAAP;IAQD,CATD,MASO;MACL,OAAQ,KAAKf,SAAN,CACJa,OADI,GAEJC,MAFI,CAEoB,CAACC,KAAD,EAAQC,KAAR,KAAkB;QACzC,IAAID,KAAK,KAAK,IAAd,EAAoB;UAClB,OAAOC,KAAK,CAACP,WAAN,EAAP;QACD;;QACD,OAAOC,IAAI,CAACP,MAAL,CAAYc,SAAZ,CAAsBN,KAAtB,EAA6BK,KAAK,CAACP,WAAN,EAA7B,EAAkDM,KAAlD,CAAP;MACD,CAPI,EAOF,IAPE,CAAP;IAQD;EACF;;AA9DD"}